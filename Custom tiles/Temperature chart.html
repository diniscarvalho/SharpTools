<!-- 
README
Create a SmartThings 'Personal Access Token' with access to devices and use it
for the 'token' setting in the tile.
https://account.smartthings.com/tokens

To configure the correct device, open the SmartThings IDE, browse devices and copy
the ID and use it for the 'Device ID' setting in the tile.

Temperature chart created by Dinis Carvalho, inspired by Joshua's scenes tile:
https://github.com/joshualyon/custom-tile-demos/tree/main/smartthings-scenes/
-->

<!-- Do not edit below -->
<script type="application/json" id="tile-settings">
    {
    "schema": "0.1.0",
    "settings": [
        {"name": "token", "label": "Token", "type": "STRING"},
        {"name": "DeviceID", "label": "Device ID", "type": "STRING"}
    ],
    "name": "Temperature chart [shortyyy]"
    }
</script>
<!-- Do not edit above -->
<!-- Styles -->
<style>    
    .main-content {
        display: flex;
        align-items: center;
        justify-content: center;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
    }
</style>

<!-- Scripts -->
<script src="https://cdn.sharptools.io/js/custom-tiles.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
<script>
    var content = document.getElementById("mainContent");
    var patToken = null;
    var deviceId = null;
    var devices = [];
    var baseUrl = "https://api.smartthings.com/v1/devices";

    function getAxiosConfig(){
        return { "headers": { "Authorization": "Bearer " + patToken } }
    }

    function init() {    
        axios.get(baseUrl + '/' + deviceId + '/status', getAxiosConfig()).then(function(response) {
            console.log('Get data response status', response.status);
            console.log(response.data);
        });
    }
        
    stio.ready((data)=>{
        // update correct settings and call init with active menu
        console.log("Starting Temperature Chart [shortyyy]");
        console.log("stio library is ready with token", data.settings.token);
        console.log("device ID token", data.settings.DeviceID);
        if(data.settings.token == null || data.settings.DeviceID == null){
            console.log("Tile not configured properly");
            return;
        }
        else {
            patToken = data.settings.token;
            deviceId = data.settings.DeviceID;
        } 
        init();
    });
</script>

<!-- HTML -->
<div class="main-content" id="mainContent">
    <canvas id="myChart" width="400" height="400"></canvas>
    <script>
    const ctx = document.getElementById('myChart').getContext('2d');
    const myChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
            datasets: [{
                label: '# of Votes',
                data: [12, 19, 3, 5, 2, 3],
                backgroundColor: [
                    'rgba(255, 99, 132, 0.2)',
                    'rgba(54, 162, 235, 0.2)',
                    'rgba(255, 206, 86, 0.2)',
                    'rgba(75, 192, 192, 0.2)',
                    'rgba(153, 102, 255, 0.2)',
                    'rgba(255, 159, 64, 0.2)'
                ],
                borderColor: [
                    'rgba(255, 99, 132, 1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(255, 206, 86, 1)',
                    'rgba(75, 192, 192, 1)',
                    'rgba(153, 102, 255, 1)',
                    'rgba(255, 159, 64, 1)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
    </script>
</div>